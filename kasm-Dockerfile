FROM kasmweb/core-ubuntu-bionic:1.10.0
USER root

ENV HOME /home/kasm-default-profile
ENV STARTUPDIR /dockerstartup
ENV INST_SCRIPTS $STARTUPDIR/install
WORKDIR $HOME

# Install VSCODE
WORKDIR $HOME
#Installing VS code
RUN apt update && apt install git -y
RUN git clone https://github.com/kasmtech/workspaces-images.git
RUN cp -r workspaces-images/src/ubuntu/install/vs_code $INST_SCRIPTS/
RUN bash $INST_SCRIPTS/install_vs_code.sh


#Installing Docker
RUN apt update && apt upgrade -y && apt install sudo -y && apt install docker.io -y

#Installing docker-compose
RUN curl -L "https://github.com/docker/compose/releases/download/1.29.2/docker-compose-$(uname -s)-$(uname -m)" -o /usr/local/bin/docker-compose \
    && chmod +x /usr/local/bin/docker-compose \
    && ln -s /usr/local/bin/docker-compose /usr/bin/docker-compose

######### End Customizations ###########

# Install Google Chrome
RUN cp -r ./workspaces-images/src/ubuntu/install/chrome $INST_SCRIPTS/chrome/
RUN bash $INST_SCRIPTS/chrome/install_chrome.sh  && rm -rf $INST_SCRIPTS/chrome/

RUN chown 1000:0 $HOME
RUN $STARTUPDIR/set_user_permission.sh $HOME

ENV HOME /home/kasm-user
WORKDIR $HOME
RUN mkdir -p $HOME && chown -R 1000:0 $HOME

USER 1000
